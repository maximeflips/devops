machine:
  pre:
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  python:
    version: 2.7.3
  services:
    - docker

dependencies:
  pre:
    - pip install docker-compose
    - pip install awscli
    - docker-compose build

test:
  override:
    #- sudo service postgresql stop
    # wait for postgresql to shutdown
    - sudo apt-get update
    - sudo apt-get install -y postgis postgresql-9.6-postgis-2.3
    - su - postgres
    - createdb geo
    - createuser Roman
    - psql geo < db/extension.sql
    - psql geo < db/country.sql
    - psql geo < db/mig.sql
    - psql geo < db/ne_10m_admin_0_countries_lakes.sql